<!DOCTYPE html>
<html>
  <head>
    <title>FileWriter Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script src="http://debug.phonegap.com/target/target-script-min.js#anonymous"></script>
  </head>
  <body>
    <input type="button" value="Write" id="writeXML" />
    <input type="button" value="Read" id="readXML" /><br/>
	<textarea id="showContentText" style="border:1px solid black;height:200px;width:500px;"></textarea><br/>
	<textarea id="showContentUrl" style="border:1px solid black;height:200px;width:500px;"></textarea>
	
	<script type="text/javascript" charset="utf-8">
	var xml = "<MAINCONFIG ResourceId='' MainId='' MainConfigurationUserId='' Name='config_2013-11-4-6-39-484.dyn' UserName='' Flag='0' TftpIpAddress='' TftpImagePath='' TftpImageName='' DateTIME='' Interval='' Iteration='' IterList='' IterNumber='' Offset='' DST='1' ResourceOrig='' ReservationType='Now' DevListFlag='' DevListCtr='' DndCtr='' TopologyName='' CommitEnable='' DeviceConfigurationEnable='' TGENConfigurationEnable='' ImageConfigurationEnable='' PortMappingEnable='' LinkSanityEnable='' URLConfigFlag='' FileType='dynamic' URLImageFlag='' SetNewValues='' RedFlag='' DomainName='' Connectivity='' DeviceSanity='' AccessSanity='' ZoneName='' DebugMode='false'><DEVICES DeviceName='' DeviceType='Dut' ObjectPath='Device_1' Model='asr1001' DNDModelType='asr1001' SoftwareVersion='' OSVersion='' OSType='' SoftwarePackage='' ReEvaluate='' IpAddress='' DeviceId='' HostName='' UpdateFlag='' MediaType='' Portname='' ManagementIp='' ManagementIp2='' Auxiliary='' DiscoveryFlag='' Exclusivity='Exclusive' XLocation='319' YLocation='214' PowerStatus='' Power='' TftpIpAddress='' TftpHostname='' TftpImagePath='' TftpImageName='' TftpUser='' TftpPassword='' TftpAddress='' TacacsIpAddress='' TacacsHostname='' RadiusHostname='' RadiusIpAddress='' RadiusUsername='' RadiusPassword='' Description='' Processor='' ProcessorBoardId='' Manufacturer='cisco' SerialNumber='' IOS='' CPUSpeed='' SystemMemory='' NVRAMCF='' ProcessorMemory='' ConnectivityDone='' ReachabilityDone='' ConvergenceDone='' TFTPUser='' TFTPPassword='' FTPServer='' TFTPServer='' FTPUser='' FTPPassword='' ConfigDetail='' ConfigFilePath='' ConfigFileName='' ConfigUrl='' SaveConfigUrl='' ConfigServer='' ConfigDestination='' ImageFilePath='' ImageDetail='' ImageFileName='' ImageUrl='' SaveImageUrl='' ImageServer='' ImageDestination='' SaveImageEnable='' SaveConfigEnable='' LoadConfigEnable='' LoadImageEnable='' SaveImageDetail='' SaveImageServer='' SaveImageDestination='' SaveImageUser='' SaveImagePassword='' SaveImageType='' SaveConfigDetail='' SaveConfigServer='' SaveConfigDestination='' SaveConfigUser='' SaveConfigPassword='' SaveConfigType='' SaveConfigFileName='' SaveImageFileName='' SystemImageName='' SystemConfigName='' SaveTypeImage='' TypeImage='' SaveTypeConfig='' TypeConfig='' ChassisPid='' ChassisVid='' ManagementInterface='' ManagementInterface2='' RouteProcessorName='' TotalMemory='' TotalMemory2='' RouteProcessorName2='' RouteRedundant='' RouteProcessorDescription='' RouteProcessorProductId='' RouteProcessorProductId2='' RouteProcessorVersionId='' RouteProcessorVersionId2='' EmbeddedRedundant='' EmbeddedProcessorName='' EmbeddedProcessorName2='' EmbeddedProcessorDescription='' EmbeddedProcessorProductId='' EmbeddedProcessorVersionId='' EmbeddedProcessorVersionId2='' EmbeddedProcessorNitrox='' EmbeddedProcessorOcteon='' EmbeddedProcessorNitrox2='' EmbeddedProcessorOcteon2='' LineCardName='' LineCardDescription='' LineCardProductId='' LineCardVersionId='' LineCardNumber='' ModuleDescription='' ModuleProductId='' ModuleName='' ModuleVersionId='' ProductFamily='' ServerType='' ManagementIpMask='' ManagementIpMask2='' ManagementIpv6='' ManagementIpv62='' ManagementIpv6Prefix='' ManagementIpv6Prefix2='' ProcessorType='' CPUCores='' ProcessorSockets='' CoresPerSocket='' LogicalProcessor='' ConsoleIp='' TitanName='' ProcessorFamily='' ProcessorPId='' ConsoleNet='' Ipv6='' Key='' Admin='' Access='' Account='' AccountPort='' AuthenticationDirectory='' AuthenticationPort='' BEHostlist='' ConfigMethod='' ConfigFile='' ConfigPath='' ConfigName='' ClearType='' COAPort='' Community='' Connectivity='' DatabaseName='' DatabaseTableName='' DatabaseType='' DefaultSM='' DeviceList='' ExtensionIp='' EnablePassword='' Features='' Function='' LogDirectory='' NRCMD='' NRCMDUsername='' Port='' RedirectPort='' RedirectLogPort='' RootDirectory='' ServerDirectory='' VendorType='' Snapshot='' DomainName='Default' Application='' Sequence='' RP0ConsoleIp='' RP1ConsoleIp=''><DEVICE ChassisAddress='' LoopBackAddress='' ObjectPath='Device_1' Username='' ESXIUsername='' Password='' ESXIPassword='' Status='' DeviceName='' DevName='Device_1' DeviceId='' RedFlag='' ModelType='asr1001' DNDModelType='asr1001' DeviceResId='' MacAddress='' DeviceFlag='' HostName='' UpdateFlag='' MediaType='' Portname='' DBResId='' ConnectivityType='' PortSpeed='' PortBandWidth='' ExactHostName='' LoadFlag='' PortView='' Discovery='' RouteProcessor='' EmbeddedProcessor='' LineCard='' ExactIpAdd='' PowerStatus='' Application='' ProtoTypeFlag='' SwitchPort='' MapName='' ControllerInfo='undefined' DeviceType='cisco' /><PORT ObjectPath='Device_1.Port_0' PortDevName='Device_1' SwitchPortInfo='' SwitchInfo='' VlanId='' VlanName='' PhysicalPortType='' PortResId='' PortSlotId='' PortId='' Number='' PortName='Port_0' UpdateFlag='' PortFlag='true' Availability='' Type='' RedFlag='' PartnerPort='' Bandwidth='' Speed='1000' EnablePort='' TunnelServicesPIC='' MultiServicesPIC='' PortType='L1' PortCheck='false' PartnerPortDevice='' PartnerInformation='' Description='' MediaType='' AutoNegotiation='' Duplexity='' PortConfig='' Phy='' Spa='' CarrierCard='' PortCard='' EthMode='' Speed2='' Sequence='' SaveConnectivity=''><PORTMAP Source='Device_1.Port_0' Id='' SrcIp='' DstIp='' Port1Id='' Port2Id='' Name='t1gb_1' Destination='Device_2.Port_1' LinkName='' CheckConnectivity='' ConnectivityDone='' SrcMonitorSlot='' DstMonitorSlot='' PortMonitorEnable='' ConnectivityFlag=''/></PORT></DEVICES><DEVICES DeviceName='' DeviceType='Dut' ObjectPath='Device_2' Model='c892fsp-k9' DNDModelType='c892fsp-k9' SoftwareVersion='' OSVersion='' OSType='' SoftwarePackage='' ReEvaluate='' IpAddress='' DeviceId='' HostName='' UpdateFlag='' MediaType='' Portname='' ManagementIp='' ManagementIp2='' Auxiliary='' DiscoveryFlag='' Exclusivity='Exclusive' XLocation='565' YLocation='211' PowerStatus='' Power='' TftpIpAddress='' TftpHostname='' TftpImagePath='' TftpImageName='' TftpUser='' TftpPassword='' TftpAddress='' TacacsIpAddress='' TacacsHostname='' RadiusHostname='' RadiusIpAddress='' RadiusUsername='' RadiusPassword='' Description='' Processor='' ProcessorBoardId='' Manufacturer='cisco' SerialNumber='' IOS='' CPUSpeed='' SystemMemory='' NVRAMCF='' ProcessorMemory='' ConnectivityDone='' ReachabilityDone='' ConvergenceDone='' TFTPUser='' TFTPPassword='' FTPServer='' TFTPServer='' FTPUser='' FTPPassword='' ConfigDetail='' ConfigFilePath='' ConfigFileName='' ConfigUrl='' SaveConfigUrl='' ConfigServer='' ConfigDestination='' ImageFilePath='' ImageDetail='' ImageFileName='' ImageUrl='' SaveImageUrl='' ImageServer='' ImageDestination='' SaveImageEnable='' SaveConfigEnable='' LoadConfigEnable='' LoadImageEnable='' SaveImageDetail='' SaveImageServer='' SaveImageDestination='' SaveImageUser='' SaveImagePassword='' SaveImageType='' SaveConfigDetail='' SaveConfigServer='' SaveConfigDestination='' SaveConfigUser='' SaveConfigPassword='' SaveConfigType='' SaveConfigFileName='' SaveImageFileName='' SystemImageName='' SystemConfigName='' SaveTypeImage='' TypeImage='' SaveTypeConfig='' TypeConfig='' ChassisPid='' ChassisVid='' ManagementInterface='' ManagementInterface2='' RouteProcessorName='' TotalMemory='' TotalMemory2='' RouteProcessorName2='' RouteRedundant='' RouteProcessorDescription='' RouteProcessorProductId='' RouteProcessorProductId2='' RouteProcessorVersionId='' RouteProcessorVersionId2='' EmbeddedRedundant='' EmbeddedProcessorName='' EmbeddedProcessorName2='' EmbeddedProcessorDescription='' EmbeddedProcessorProductId='' EmbeddedProcessorVersionId='' EmbeddedProcessorVersionId2='' EmbeddedProcessorNitrox='' EmbeddedProcessorOcteon='' EmbeddedProcessorNitrox2='' EmbeddedProcessorOcteon2='' LineCardName='' LineCardDescription='' LineCardProductId='' LineCardVersionId='' LineCardNumber='' ModuleDescription='' ModuleProductId='' ModuleName='' ModuleVersionId='' ProductFamily='' ServerType='' ManagementIpMask='' ManagementIpMask2='' ManagementIpv6='' ManagementIpv62='' ManagementIpv6Prefix='' ManagementIpv6Prefix2='' ProcessorType='' CPUCores='' ProcessorSockets='' CoresPerSocket='' LogicalProcessor='' ConsoleIp='' TitanName='' ProcessorFamily='' ProcessorPId='' ConsoleNet='' Ipv6='' Key='' Admin='' Access='' Account='' AccountPort='' AuthenticationDirectory='' AuthenticationPort='' BEHostlist='' ConfigMethod='' ConfigFile='' ConfigPath='' ConfigName='' ClearType='' COAPort='' Community='' Connectivity='' DatabaseName='' DatabaseTableName='' DatabaseType='' DefaultSM='' DeviceList='' ExtensionIp='' EnablePassword='' Features='' Function='' LogDirectory='' NRCMD='' NRCMDUsername='' Port='' RedirectPort='' RedirectLogPort='' RootDirectory='' ServerDirectory='' VendorType='' Snapshot='' DomainName='Default' Application='' Sequence='' RP0ConsoleIp='' RP1ConsoleIp=''><DEVICE ChassisAddress='' LoopBackAddress='' ObjectPath='Device_2' Username='' ESXIUsername='' Password='' ESXIPassword='' Status='' DeviceName='' DevName='Device_2' DeviceId='' RedFlag='' ModelType='c892fsp-k9' DNDModelType='c892fsp-k9' DeviceResId='' MacAddress='' DeviceFlag='' HostName='' UpdateFlag='' MediaType='' Portname='' DBResId='' ConnectivityType='' PortSpeed='' PortBandWidth='' ExactHostName='' LoadFlag='' PortView='' Discovery='' RouteProcessor='' EmbeddedProcessor='' LineCard='' ExactIpAdd='' PowerStatus='' Application='' ProtoTypeFlag='' SwitchPort='' MapName='' ControllerInfo='undefined' DeviceType='cisco' /><PORT ObjectPath='Device_2.Port_1' PortDevName='Device_2' SwitchPortInfo='' SwitchInfo='' VlanId='' VlanName='' PhysicalPortType='' PortResId='' PortSlotId='' PortId='' Number='' PortName='Port_1' UpdateFlag='' PortFlag='true' Availability='' Type='' RedFlag='' PartnerPort='' Bandwidth='' Speed='1000' EnablePort='' TunnelServicesPIC='' MultiServicesPIC='' PortType='L1' PortCheck='false' PartnerPortDevice='' PartnerInformation='' Description='' MediaType='' AutoNegotiation='' Duplexity='' PortConfig='' Phy='' Spa='' CarrierCard='' PortCard='' EthMode='' Speed2='' Sequence='' SaveConnectivity=''><PORTMAP Source='Device_1.Port_0' Id='' SrcIp='' DstIp='' Port1Id='' Port2Id='' Name='t1gb_1' Destination='Device_2.Port_1' LinkName='' CheckConnectivity='' ConnectivityDone='' SrcMonitorSlot='' DstMonitorSlot='' PortMonitorEnable='' ConnectivityFlag=''/></PORT></DEVICES></MAINCONFIG>";
	
    // Wait for Cordova to load
    document.getElementById("writeXML").addEventListener("click", onDeviceReady);
    document.getElementById("readXML").addEventListener("click", onDeviceReadyRead);
    //document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    //
    function onDeviceReady() {
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
    }

    function gotFS(fileSystem) {
        fileSystem.root.getFile("xml.xml", {create: true, exclusive: false}, gotFileEntry, fail);
    }

    function gotFileEntry(fileEntry) {
        fileEntry.createWriter(gotFileWriter, fail);
    }

    function gotFileWriter(writer) {
        writer.onwriteend = function(evt) {
       /*     alert("contents of file now 'some sample text'");
            writer.truncate(11);  
            writer.onwriteend = function(evt) {
                alert("contents of file now 'some sample'");
                writer.seek(4);
                writer.write(" different text");
                writer.onwriteend = function(evt){
                    alert("contents of file now ' different text'");
                    onDeviceReadyRead();
                }
            };*/
			alert("xml now created!");
			onDeviceReadyRead();
        };
        writer.write(xml);
		
    }

    function fail(error) {
        alert(error.code);
    }
    
    
    function onDeviceReadyRead() {
    	//alert("Pasok sa onDeviceReadyRead?");
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFSRead, failRead);
    }
    function gotFSRead(fileSystem) {
    	//alert("Pasok sa gotFSRead?"+fileSystem);
        fileSystem.root.getFile("xml.xml", null, gotFileEntryRead, failRead);
    }

    function gotFileEntryRead(fileEntry) {
    	//alert("Pasok sa gotFileEntryRead?"+fileEntry);
        fileEntry.file(gotFileRead, fail);
    }

    function gotFileRead(file){
    	//alert("Pasok sa gotFileRead?"+file);
        readDataUrl(file);
        readAsText(file);
    }

   function readDataUrl(file) {
   	//alert("Pasok sa readDataUrl?"+file);
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            alert("Read as data URL");
            alert(evt.target.result);
		document.getElementById("showContentUrl").value= evt.target.result;
        };
        reader.readAsDataURL(file);
    }

    function readAsText(file) {
    	//alert("Pasok sa readAsText?"+file);
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            alert("Read as text");
            alert(evt.target.result);
            document.getElementById("showContentText").value= evt.target.result;
			// Get a list of all the entries in the directory
            directoryReader.readEntries(success,fail);
        };
        reader.readAsText(file);
    }

    function failRead(evt) {
    	//alert("Pasok sa readAsTextRead?"+evt);
        alert(evt.target.error.code);
    }
    
    
    function success(entries) {
    	//var i;
    	//for (i=0; i<entries.length; i++) {
        	alert(entries.name);
    //	}
    }
    function fail(error) {
    	alert("Failed to list directory contents: " + error.code);
    }
    // Get a directory reader
    var directoryReader = dirEntry.createReader();
    
    </script>
  </body>
</html>
